# 🎮 视觉小说框架使用指南

## 📋 目录
1. [项目结构概述](#项目结构概述)
2. [美术资源准备](#美术资源准备)
3. [角色系统配置](#角色系统配置)
4. [场景数据创建](#场景数据创建)
5. [UI界面配置](#UI界面配置)
6. [音频系统配置](#音频系统配置)
7. [游戏测试与运行](#游戏测试与运行)
8. [常见问题解答](#常见问题解答)

## 🏗️ 项目结构概述

### 核心脚本文件
- **GameManager.cs** - 游戏状态管理和存档系统
- **CharacterManager.cs** - 角色数据管理和表情系统
- **DialogueSystem.cs** - 对话流程控制和选择分支
- **SceneDataManager.cs** - 场景数据加载和管理
- **UIManager.cs** - 界面切换和设置管理
- **AudioManager.cs** - 音频播放和音量控制

### 资源文件夹结构
```
Assets/
├── Resources/
│   ├── Characters/      # 角色立绘和表情
│   ├── Backgrounds/     # 场景背景图片
│   ├── Audio/          # 音频文件
│   │   ├── BGM/        # 背景音乐
│   │   ├── Voices/     # 角色语音
│   │   └── SFX/        # 音效
│   └── UI/             # UI精灵和图标
├── Scripts/            # 所有C#脚本
└── Scenes/             # Unity场景文件
```

## 🎨 美术资源准备

### 1. 角色立绘规范
- **尺寸**: 建议1024x1024或2048x2048像素
- **格式**: PNG（支持透明通道）
- **命名**: `角色名_表情.png`
  - 示例: `Alice_Normal.png`, `Alice_Happy.png`

### 2. 表情类型
```csharp
public enum Expression
{
    Normal,    // 普通
    Happy,     // 开心
    Sad,       // 悲伤
    Angry,     // 生气
    Surprised, // 惊讶
    // 可自定义添加更多表情
}
```

### 3. 背景图片
- **尺寸**: 1920x1080（16:9标准分辨率）
- **格式**: PNG或JPG
- **命名**: 描述性名称，如 `school_classroom.png`

## 👥 角色系统配置

### 1. 配置角色数据
在Unity编辑器中配置CharacterManager：

1. 在Hierarchy中创建空GameObject，添加CharacterManager组件
2. 在Inspector面板中点击"+"添加新角色
3. 配置每个角色的属性：

| 属性 | 说明 | 示例值 |
|------|------|--------|
| characterName | 角色英文名（代码中使用） | Alice |
| fullName | 角色全名（显示用） | 爱丽丝 |
| age | 年龄 | 18 |
| personality | 性格描述 | 活泼开朗的少女 |
| background | 背景故事 | 来自魔法学院的优等生 |
| nameColor | 名字显示颜色 | #FF6B6B |
| expressions | 表情精灵数组 | 拖拽6个表情图片 |

### 2. 代码中引用角色
```csharp
// 获取角色数据
Character alice = CharacterManager.Instance.GetCharacter("Alice");

// 修改角色好感度
CharacterManager.Instance.ModifyAffection("Alice", 10);

// 获取当前好感度
int affection = CharacterManager.Instance.GetAffection("Alice");
```

## 🎭 场景数据创建

### 1. 创建场景数据

**方法一：通过SceneDataManager代码创建**
```csharp
SceneData scene = new SceneData
{
    sceneId = "chapter1_scene1",
    dialogueLines = new List<DialogueLine>
    {
        new DialogueLine
        {
            characterName = "Alice",
            dialogueText = "你好，欢迎来到我的世界！",
            expression = Expression.Happy,
            voiceClip = Resources.Load<AudioClip>("Audio/Voices/Alice/hello")
        },
        new DialogueLine
        {
            characterName = "Player", // 玩家对话
            dialogueText = "这里真漂亮！",
            expression = Expression.Normal
        }
    },
    choices = new List<Choice>
    {
        new Choice
        {
            choiceText = "称赞环境",
            nextScene = "chapter1_scene2",
            effects = new Dictionary<string, int> { { "affection_Alice", 5 } }
        },
        new Choice
        {
            choiceText = "询问来历", 
            nextScene = "chapter1_scene3",
            effects = new Dictionary<string, int> { { "flag_asked_origin", 1 } }
        }
    },
    backgroundImage = Resources.Load<Sprite>("Backgrounds/magic_forest"),
    backgroundMusic = Resources.Load<AudioClip>("Audio/BGM/peaceful")
};

SceneDataManager.Instance.AddScene(scene);
```

**方法二：使用ScriptableObject（推荐）**
1. 创建继承自ScriptableObject的场景数据类
2. 在Editor文件夹中创建自定义编辑器
3. 通过Asset菜单创建场景数据资产

### 2. 场景连接与分支

```csharp
// 线性场景流程
scene1 → scene2 → scene3

// 分支选择流程
          scene1
         /      \
    choiceA    choiceB
     /            \
scene2           scene3
    \            /
     scene4 (汇合)

// 条件跳转
if (GameManager.Instance.GetFlag("met_Alice"))
    nextScene = "scene_with_Alice";
else
    nextScene = "scene_alone";
```

## 🖥️ UI界面配置

### 1. 主界面配置

在UIManager中拖拽对应的UI组件：

| UI组件 | 对应字段 | 说明 |
|--------|----------|------|
| 开始按钮 | startButton | 开始新游戏 |
| 继续按钮 | continueButton | 继续游戏 |
| 设置按钮 | settingsButton | 打开设置 |
| 退出按钮 | quitButton | 退出游戏 |

### 2. 对话界面配置

| UI组件 | 对应字段 | 说明 |
|--------|----------|------|
| 对话框 | dialoguePanel | 对话容器 |
| 角色名文本 | nameText | 显示角色名 |
| 对话文本 | dialogueText | 显示对话内容 |
| 角色头像 | characterImage | 显示角色头像 |
| 选择按钮容器 | choicesPanel | 选择项父对象 |
| 选择按钮预制体 | choiceButtonPrefab | 选择按钮模板 |

### 3. 设置界面配置

```csharp
// 音量控制
UIManager.Instance.SetBGMVolume(0.8f);
UIManager.Instance.SetSFXVolume(0.7f);

// 画面设置
UIManager.Instance.SetResolution(1920, 1080);
UIManager.Instance.SetFullscreen(true);
```

## 🔊 音频系统配置

### 1. 音频文件组织

```
Assets/Resources/Audio/
├── BGM/
│   ├── main_theme.mp3
│   ├── peaceful.mp3
│   └── battle.mp3
├── Voices/
│   ├── Alice/
│   │   ├── hello.wav
│   │   ├── yes.wav
│   │   └── no.wav
│   └── Bob/
│       ├── greeting.wav
│       └── question.wav
└── SFX/
    ├── ui_click.wav
    ├── ui_hover.wav
    └── notification.wav
```

### 2. 音频管理器配置

在AudioManager的Inspector中拖拽音频文件：

- **bgmTracks**: 背景音乐列表
- **ambientSounds**: 环境音列表
- **uiSfx**: UI音效列表

### 3. 代码中播放音频

```csharp
// 播放背景音乐
AudioManager.Instance.PlayBGM("main_theme");

// 播放角色语音
AudioManager.Instance.PlayVoice("Alice", "hello");

// 播放UI音效
AudioManager.Instance.PlayUISFX("click");

// 设置音量
AudioManager.Instance.SetBGMVolume(0.8f);
AudioManager.Instance.SetVoiceVolume(1.0f);
AudioManager.Instance.SetSFXVolume(0.7f);
```

## 🎯 游戏测试与运行

### 1. 启动游戏流程

```csharp
// 方法一：通过UIManager
UIManager.Instance.ShowMainMenu();

// 方法二：直接开始游戏
UIManager.Instance.StartNewGame();

// 方法三：加载存档
UIManager.Instance.LoadGame(1); // 加载存档槽1
```

### 2. 测试特定场景

```csharp
// 在QuickStartGuide组件上测试
public class TestScene : MonoBehaviour
{
    void Start()
    {
        // 等待1秒后开始测试场景
        Invoke("StartTestScene", 1f);
    }
    
    void StartTestScene()
    {
        DialogueSystem.Instance.StartScene("test_scene");
    }
    
    // 编辑器快捷测试
    [ContextMenu("测试当前场景")]
    void TestCurrentScene()
    {
        StartTestScene();
    }
}
```

### 3. 调试技巧

```csharp
// 查看当前游戏状态
Debug.Log("当前章节: " + GameManager.Instance.currentChapter);
Debug.Log("当前场景: " + GameManager.Instance.currentScene);
Debug.Log("爱丽丝好感度: " + CharacterManager.Instance.GetAffection("Alice"));

// 检查标志位
if (GameManager.Instance.GetFlag("met_Alice"))
    Debug.Log("已经见过爱丽丝");

// 列出所有场景
foreach (var scene in SceneDataManager.Instance.GetAllScenes())
    Debug.Log("场景: " + scene.sceneId);
```

## ❓ 常见问题解答

### Q1: 角色立绘不显示怎么办？
A: 检查以下内容：
- 图片是否放在Resources/Characters文件夹
- 图片格式是否为PNG（支持透明通道）
- 在CharacterManager中是否正确配置了表情数组

### Q2: 音频文件无法播放？
A: 检查以下内容：
- 音频文件是否放在Resources/Audio对应子文件夹
- 文件格式是否支持（MP3、WAV、OGG）
- 在AudioManager中是否正确配置了音频剪辑

### Q3: 选择分支不生效？
A: 检查以下内容：
- 选择项的nextScene是否正确设置
- 目标场景是否存在于SceneDataManager中
- 是否有条件判断阻止了场景跳转

### Q4: 存档功能异常？
A: 检查以下内容：
- 是否调用了GameManager.Instance.SaveGame()
- 存档槽位是否正确（1-3）
- 玩家设置是否允许本地存储

### Q5: 如何添加新角色？
A: 在CharacterManager的Inspector中：
1. 点击characters列表的"+"按钮
2. 填写角色基本信息
3. 拖拽表情精灵到expressions数组
4. 在场景数据中使用characterName引用

## 🚀 进阶功能

### 1. 自定义表达式系统
```csharp
// 扩展表情枚举
public enum CustomExpression
{
    Normal,
    Happy,
    Sad,
    Angry,
    Surprised,
    Blush,    // 脸红
    Confused, // 困惑
    Sleepy    // 困倦
}

// 自定义表情映射
public Dictionary<CustomExpression, Sprite> customExpressions;
```

### 2. 动态场景生成
```csharp
// 根据条件动态创建场景
SceneData CreateDynamicScene()
{
    SceneData scene = new SceneData();
    
    if (GameManager.Instance.GetFlag("is_night"))
    {
        scene.backgroundImage = Resources.Load<Sprite>("Backgrounds/night");
        scene.backgroundMusic = Resources.Load<AudioClip>("Audio/BGM/night_theme");
    }
    else
    {
        scene.backgroundImage = Resources.Load<Sprite>("Backgrounds/day");
        scene.backgroundMusic = Resources.Load<AudioClip>("Audio/BGM/day_theme");
    }
    
    return scene;
}
```

### 3. 多语言支持
```csharp
// 多语言对话系统
[System.Serializable]
public class LocalizedDialogue
{
    public string sceneId;
    public List<LocalizedLine> lines;
}

[System.Serializable]
public class LocalizedLine
{
    public string characterName;
    public Dictionary<string, string> translations; // key: language, value: text
}
```

## 📞 技术支持

如果遇到问题，可以：
1. 查看Console窗口的错误信息
2. 检查所有Inspector配置是否正确
3. 阅读对应脚本的注释说明
4. 在脚本中添加Debug.Log进行调试

祝您使用愉快！🎉